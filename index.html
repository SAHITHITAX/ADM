<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Collection Form</title>
    <style>
        /* Style for the fixed form */
        #dataForm {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #f9f9f9;
            padding: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        #dataForm label {
            margin-right: 5px;
        }

        #dataForm input {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        #dataForm button {
            padding: 5px 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #dataForm button:hover {
            background-color: #0056b3;
        }

        /* Add margin to the table to avoid overlapping with the fixed form */
        #dataTable {
            margin-top: 170px; /* Adjust this value based on the height of your form */
        }

        /* Style for the table */
        #dataTable {
            width: 100%;
            border-collapse: collapse;
        }

        #dataTable th, #dataTable td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        #dataTable th {
            background-color: #f2f2f2;
        }

        #dataTable tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        #dataTable tr:hover {
            background-color: #f1f1f1;
        }

        /* Style for action buttons */
        #dataTable button {
            padding: 5px 10px;
            margin: 2px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #dataTable button.edit {
            background-color: #28a745;
            color: white;
        }

        #dataTable button.delete {
            background-color: #dc3545;
            color: white;
        }

        #dataTable button.whatsapp {
            background-color: #25d366;
            color: white;
        }

        #dataTable button.open-folder {
            background-color: #17a2b8;
            color: white;
        }

        /* Style for the form container */
        #dataForm {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: #f9f9f9;
            padding: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        /* Style for labels and inputs */
        #dataForm label {
            margin: 0 5px;
        }

        #dataForm input {
            padding: 5px;
            margin: 0 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        /* Style for the submit button */
        #dataForm button {
            padding: 5px 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        #dataForm button:hover {
            background-color: #0056b3;
        }

        /* Style for the heading and caption */
        .form-header {
            width: 100%;
            text-align: center;
            margin-bottom: 10px;
        }

        .form-header h1 {
            margin: 0;
            font-size: 72px;
            color: #333;
        }

        .form-header p {
            margin: 0;
            font-size: 36px;
            color: #666;
        }

        .apple-button {
            text-decoration: none;
            font-size: 16px;
            font-weight: bold;
            padding: 12px 20px;
            border-radius: 30px;
            background: linear-gradient(to bottom, #ffffff, #e0e0e0);
            color: #333;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border: none;
            text-align: center;
        }

        .apple-button:hover {
            background: linear-gradient(to bottom, #e0e0e0, #d0d0d0);
            box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <h2>Data Collection Form</h2>
    <form id="dataForm">
        <div class="form-header">
            <h1>CoreTax</h1>
            <p>We provide expert tax consulting services.</p>
        </div>
        <div class="button-container">
            <a href="#" class="apple-button" onclick="filterData('URGENT'); return false;">URGENT</a>
            <a href="#" class="apple-button" onclick="filterData('PENDING'); return false;">PENDING</a>
            <a href="#" class="apple-button" onclick="filterData('REMIND'); return false;">REMIND</a>
            <a href="#" class="apple-button" onclick="filterData('DOCS'); return false;">DOCS</a>
            <a href="#" class="apple-button" onclick="filterData('NEW'); return false;">NEW</a>
            <a href="#" class="apple-button" onclick="filterData('CALL'); return false;">CALL</a>
            <a href="#" class="apple-button" onclick="filterData('BAL'); return false;">BAL</a>
            <a href="#" class="apple-button" onclick="filterData('RATING'); return false;">RATING</a>
            <a href="#" class="apple-button" onclick="filterData('TO BE'); return false;">TO BE</a>
            <a href="#" class="apple-button" onclick="filterData('LABOUR REMINDER'); return false;">LABOUR REMINDER</a>
            <a href="#" class="apple-button" onclick="filterData('ITR REMINDER'); return false;">ITR REMINDER</a>
            <a href="#" class="apple-button" onclick="filterData('GST RETURN'); return false;">GST RETURN</a>
            <a href="#" class="apple-button" onclick="filterData('TEST'); return false;">TEST</a>
        </div>
        <input type="hidden" id="editId">
        <label for="name">Name:</label>
        <input type="text" id="name" name="name" required>
        <label for="mobile">Mobile:</label>
        <input type="tel" id="mobile" name="mobile" required>
        <label for="email">Email:</label>
        <input type="email" id="email" name="email" required>
        <label for="work">Work:</label>
        <input type="text" id="work" name="work" required>
        <label for="assign">Assign:</label>
        <input type="text" id="assign" name="assign" required>
        <label for="status">Status:</label>
        <input type="text" id="status" name="status" required>
        <label for="remark">Remark:</label>
        <input type="text" id="remark" name="remark" required>
        <label for="username">Username:</label>
        <input type="text" id="username" name="username" required>
        <label for="password">Password:</label>
        <input type="password" id="password" name="password" required>
        <label for="charges">Charges:</label>
        <input type="number" id="charges" name="charges" required>
        <label for="dueDate">Due Date:</label>
        <input type="date" id="dueDate" name="dueDate" required>
        <button type="button" onclick="submitForm()">Submit</button>
    </form>

    <h2>Submitted Data</h2>
    <table border="1" id="dataTable">
        <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Mobile</th>
            <th>Email</th>
            <th>Work</th>
            <th>Assign</th>
            <th>Status</th>
            <th>Remark</th>
            <th>Username</th>
            <th>Password</th>
            <th>Charges</th>
            <th>Due Date</th>
            <th>Actions</th>
            <th>Folder</th>
            <th>WhatsApp</th>
        </tr>
    </table>

    <script>
        let editMode = false;
        let editId = null;
        let currentFilter = null; // Track the current filter

        function filterData(status) {
            currentFilter = status; // Set the current filter
            fetchData(); // Fetch and display filtered data
        }

        function submitForm() {
            const formData = {
                id: editMode ? editId : null,
                name: document.getElementById("name").value,
                mobile: document.getElementById("mobile").value,
                email: document.getElementById("email").value,
                work: document.getElementById("work").value,
                assign: document.getElementById("assign").value,
                status: document.getElementById("status").value,
                remark: document.getElementById("remark").value,
                username: document.getElementById("username").value,
                password: document.getElementById("password").value,
                charges: document.getElementById("charges").value,
                dueDate: document.getElementById("dueDate").value
            };

            fetch('https://script.google.com/macros/s/AKfycbzN788DR1TtAarYEzjD283sLr9Lh74t2885GxVE7ZcDC6aFnbihEnkPRrQLBxoLGEy6Dg/exec', {
                method: 'POST',
                mode: 'no-cors',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(formData)
            }).then(() => {
                alert(editMode ? "Data updated successfully!" : "Data submitted successfully!");
                document.getElementById("dataForm").reset();
                editMode = false;
                editId = null;
                fetchData();
            }).catch(error => console.error("Error:", error));
        }

        function fetchData() {
            fetch('https://script.google.com/macros/s/AKfycbzN788DR1TtAarYEzjD283sLr9Lh74t2885GxVE7ZcDC6aFnbihEnkPRrQLBxoLGEy6Dg/exec')
                .then(response => response.json())
                .then(data => {
                    // Apply the filter if one is set
                    if (currentFilter) {
                        data = data.filter(row => row.status === currentFilter);
                    }

                    const table = document.getElementById("dataTable");
                    table.innerHTML = `
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Mobile</th>
                            <th>Email</th>
                            <th>Work</th>
                            <th>Assign</th>
                            <th>Status</th>
                            <th>Remark</th>
                            <th>Username</th>
                            <th>Password</th>
                            <th>Charges</th>
                            <th>Due Date</th>
                            <th>Actions</th>
                            <th>Folder</th>
                            <th>WhatsApp</th>
                        </tr>
                    `;
                    data.forEach((row) => {
                        const newRow = table.insertRow();
                        newRow.insertCell(0).innerText = row.id;
                        newRow.insertCell(1).innerText = row.name;
                        newRow.insertCell(2).innerText = row.mobile;
                        newRow.insertCell(3).innerText = row.email;
                        newRow.insertCell(4).innerText = row.work;
                        newRow.insertCell(5).innerText = row.assign;
                        newRow.insertCell(6).innerText = row.status;
                        newRow.insertCell(7).innerText = row.remark;
                        newRow.insertCell(8).innerText = row.username;
                        newRow.insertCell(9).innerText = row.password;
                        newRow.insertCell(10).innerText = row.charges;
                        newRow.insertCell(11).innerText = row.dueDate;
                        const actionCell = newRow.insertCell(12);

                        // Edit Button
                        const editButton = document.createElement("button");
                        editButton.innerText = "Edit";
                        editButton.classList.add("edit");
                        editButton.onclick = function() { editRow(row); };
                        actionCell.appendChild(editButton);

                        // Delete Button
                        const deleteButton = document.createElement("button");
                        deleteButton.innerText = "Delete";
                        deleteButton.classList.add("delete");
                        deleteButton.onclick = function() { deleteRow(row.id); };
                        actionCell.appendChild(deleteButton);

                        // Open Folder Button
                        const folderCell = newRow.insertCell(13);
                        if (row.folderId) {
                            const openFolderButton = document.createElement("button");
                            openFolderButton.innerText = "Open Folder";
                            openFolderButton.classList.add("open-folder");
                            openFolderButton.onclick = function() { openFolder(row.folderId); };
                            folderCell.appendChild(openFolderButton);
                        } else {
                            folderCell.innerText = "No Folder";
                        }

                        // WhatsApp Button
                        const whatsappCell = newRow.insertCell(14);
                        const whatsappButton = document.createElement("button");
                        whatsappButton.innerText = "WhatsApp";
                        whatsappButton.classList.add("whatsapp");
                        whatsappButton.onclick = function() { sendWhatsAppMessage(row); };
                        whatsappCell.appendChild(whatsappButton);
                    });
                })
                .catch(error => console.error("Error fetching data:", error));
        }

        function editRow(row) {
            document.getElementById("editId").value = row.id;
            document.getElementById("name").value = row.name;
            document.getElementById("mobile").value = row.mobile;
            document.getElementById("email").value = row.email;
            document.getElementById("work").value = row.work;
            document.getElementById("assign").value = row.assign;
            document.getElementById("status").value = row.status;
            document.getElementById("remark").value = row.remark;
            document.getElementById("username").value = row.username;
            document.getElementById("password").value = row.password;
            document.getElementById("charges").value = row.charges;
            document.getElementById("dueDate").value = row.dueDate;
            editMode = true;
            editId = row.id;
        }

        function deleteRow(id) {
            if (confirm("Are you sure you want to delete this record?")) {
                fetch('https://script.google.com/macros/s/AKfycbzN788DR1TtAarYEzjD283sLr9Lh74t2885GxVE7ZcDC6aFnbihEnkPRrQLBxoLGEy6Dg/exec', {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ id: id, action: 'delete' })
                }).then(() => {
                    alert("Record deleted successfully!");
                    fetchData();
                }).catch(error => console.error("Error:", error));
            }
        }

        function openFolder(folderId) {
            const folderUrl = `https://drive.google.com/drive/folders/${folderId}`;
            window.open(folderUrl, "_blank");
        }

        function sendWhatsAppMessage(row) {
            const mobile = row.mobile.replace(/\D/g, ''); // Remove all non-numeric characters
            let internationalMobile;
            if (mobile.startsWith('+')) {
                internationalMobile = mobile;
            } else if (mobile.startsWith('91') && mobile.length === 12) {
                internationalMobile = `+${mobile}`;
            } else if (mobile.length === 10) {
                internationalMobile = `+91${mobile}`;
            } else {
                internationalMobile = mobile;
            }

            const message = `Hello ${row.name}, your work on ${row.work} is currently ${row.status}. Due date: ${row.dueDate}.`;
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://wa.me/${internationalMobile}?text=${encodedMessage}`;
            window.open(whatsappUrl, "_blank");
        }

        window.onload = fetchData;
    </script>
</body>
</html>
